# 06 â€“ Supabase & SQL safety

Status: Reviewed migrations and config; no schema changes applied.

## RLS policies

- Tables with RLS enabled in migrations include: `profiles`, `dogs`, `availability`, `conversations`, `messages`, `account_deletion_requests`, `deleted_emails`, `reviews_pending`, and others per initial schema.
- Policies present for common operations (SELECT/INSERT/UPDATE/DELETE) tied to `auth.uid()` where appropriate.

## search_path and qualification

- `supabase/config.toml` sets `extra_search_path = ["public", "extensions"]`. No mutable `SET search_path` found in migrations.
- Recommend schema-qualified references in SQL functions if/when edited in the future.

## Indexes

- Numerous `CREATE INDEX IF NOT EXISTS` statements exist across hot tables (`availability`, `meetings`, `reviews`, `dogs`, `profiles`, `messages`, `conversations`).
- Composite indexes for frequent filters are in place (e.g., `availability(owner_id, post_type, status)`, `meetings(requester_id, recipient_id, status)`).

## Opportunities (documented, not applied)

- Verify query plans for endpoints with slow responses and add missing composite indexes if needed (attach EXPLAIN in a dedicated PR).
- Periodically re-run index usage stats and drop unused indexes to reduce write overhead.

## Manual QA note

- No SQL or policy changes were applied in this audit step; documentation only.
